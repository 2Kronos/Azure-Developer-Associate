# Circuit

[Combine IR remote and POT](https://www.tinkercad.com/things/ab8mriBIJri-phase-2-simulation-23)
# Code

```C++
#include <IRremote.hpp>

const int IR_PIN = 3;
const int POT_PIN = A0;
unsigned long inputVal;
int currentPowerLevel = 0;
bool useIRPower = 0;

void setup() {
    IrReceiver.begin(IR_PIN, ENABLE_LED_FEEDBACK);
    pinMode(POT_PIN, INPUT);
    Serial.begin(9600);
    Serial.println("Solar Power Simulator Ready");
    Serial.println("-------------------");
}

void loop() {
    checkIR();          // Check for IR remote input
    checkPotentiometer(); // Check potentiometer if no IR signal
    resetFlags();       // Reset for next iteration
    delay(500);
}

// Function to check IR remote
void checkIR() {
    if (IrReceiver.decode()) {
        inputVal = IrReceiver.decodedIRData.decodedRawData;
        IrReceiver.resume();
        
        int irLevel = irPower(inputVal);
        if (irLevel != -1) {
            currentPowerLevel = irLevel;
            useIRPower = 1;
            Serial.print("IR Remote: ");
            displayPowerLevel(currentPowerLevel);
        }
    }
}

// Function to check potentiometer
void checkPotentiometer() {
    if (useIRPower == 0) {
        int potIn = analogRead(POT_PIN);
        currentPowerLevel = map(potIn, 0, 1023, 3, 0);
        currentPowerLevel = constrain(currentPowerLevel, 0, 3);
        
        Serial.print("Potentiometer: ");
        displayPowerLevel(currentPowerLevel);
    }
}

// Function to reset flags
void resetFlags() {
    useIRPower = 0;
}

// Function to convert IR code to power level
int irPower(unsigned long irValue) {
    switch(irValue) {
        case 4077698816: return 0;
        case 4010852096: return 1;
        case 3994140416: return 2;
        case 3977428736: return 3;
        default: return -1;
    }
}

// Function to display power level description
void displayPowerLevel(int powerLevel) {
    switch(powerLevel) {
        case 0: Serial.println("Power Level 0: Battery charging"); break;
        case 1: Serial.println("Power Level 1: Insufficient Power"); break;
        case 2: Serial.println("Power Level 2: Moderate Power"); break;
        case 3: Serial.println("Power Level 3: Maximum Power"); break;
        default: Serial.println("Off or Error"); break;
    }
    Serial.println("-------------------");
}
```

## Output

```C++
------------- 
Potentiometer: Power Level 2: Moderate Power 

------------------- 
IR Remote: Power Level 3: Maximum Power

 ------------------- 
 Potentiometer: Power Level 2: Moderate Power
 
 ------------------- 
 IR Remote: Power Level 3: Maximum Power

```


### **Technical Note: Dynamic Power Simulation Behavior**

**Observation:**  
The system output shows alternating power readings:

- `Potentiometer: Power Level 2: Moderate Power`
    
- `IR Remote: Power Level 3: Maximum Power`
    
- _...repeating pattern..._
    

**Explanation of Behavior:**  
This output demonstrates the **correct implementation of dynamic power management** as required by the project specifications. The system is designed to prioritize real-time solar availability signals over static manual settings.

**Why This is Correct and Desirable:**

1. **Real-World Solar Fidelity:** This behavior accurately simulates how a real solar-powered system operates. Solar energy is not constant; it fluctuates due to:
    
    - Passing clouds
        
    - Changes in sunlight intensity
        
    - Other household appliances turning on/off
        
    - Battery charge/discharge cycles  
        The IR remote allows us to simulate these transient, real-world conditions on demand.
        
2. **Priority-Based Architecture:** The code is structured to give the IR signal (simulating the live solar inverter) **absolute priority**. When an IR command is received, it immediately overrides the static potentiometer value. This ensures the washing machine controller always reacts to the most recent "solar conditions."
    
3. **Temporary Override Design:** The IR command's effect is intentionally limited to a single processing cycle (500ms). After this, the system reverts to reading the potentiometer. This is a **feature, not a bug**. It means:
    
    - A single button press simulates a **brief spike or drop** in available power (e.g., a cloud passing over).
